<!-- Module User's Guide -->

<chapter>
	<chapterinfo>
	<revhistory>
		<revision>
		<revnumber>$Revision: 1953 $</revnumber>
		<date>$Date: 2007-04-04 11:50:33 +0300 (Wed, 04 Apr 2007) $</date>
		</revision>
	</revhistory>
	</chapterinfo>
	<title>User's Guide</title>
	
	<section>
	<title>Overview</title>
	<para> 
	The module does specific handling for notify-subscribe events using xml bodies.
	It is used with the general event handling module, presence. It constructs and adds
	3 events to it: presence, presence.winfo, dialog;sla. 
	</para>
	<para>
	This module uses xcap_table with permission rules to deal with authorization rules 
	for presence.
	</para>
	<para>
	</section>

	<section>
	<title>Dependencies</title>
	<section>
		<title>&ser; Modules</title>
		<para>
		The following modules must be loaded before this module:
			<itemizedlist>
			<listitem>
			<para>
				<emphasis>a database module</emphasis>.
			</para>
			</listitem>
			<listitem>
			<para>
				<emphasis>presence</emphasis>.
			</para>
			</listitem>
			<listitem>
			<para>
				<emphasis>sl</emphasis>.
			</para>
			</listitem>
			<listitem>
			<para>
				<emphasis>xcap_client</emphasis>.
			</para>
			<para>
			Only compulsory if not using an integrated xcap server 
			(if 'integrated_xcap_server' parameter is not set).
			</para>
			</listitem>

			</itemizedlist>
		</para>
	</section>

	<section>
		<title>External Libraries or Applications</title>
		<para>
		The following libraries or applications must be installed before running
		&ser; with this module loaded:
			<itemizedlist>
			<listitem>
			<para>
				<emphasis>libxml</emphasis>.
			</para>
			</listitem>
			</itemizedlist>
		</para>
	</section>
	</section>
	
	<section>
	<title>Exported Parameters</title>
	<section>
		<title><varname>db_url</varname>(str)</title>
		<para>
		The database url.
		</para>
		<para>
		<emphasis>	Default value is <quote>NULL</quote>.	
		</emphasis>
		</para>
		<example>
		<title>Set <varname>db_url</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("presence_xml", "db_url", 
	"mysql://openser:openserrw@192.168.2.132/openser")
...
</programlisting>
		</example>
	</section>
	<section>
		<title><varname>xcap_table</varname>(str)</title>
		<para>
		The name of the db table where XCAP documents are stored.
		</para>
		<para>
		<emphasis>	Default value is <quote>xcap</quote>.
		</emphasis>
		</para>
		<example>
		<title>Set <varname>xcap_table</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("presence_xml", "xcap_table", "xcaps")
...
</programlisting>
		</example>
	</section>

	<section>
		<title><varname>force_active</varname> (int)</title>
		<para>
		This parameter is used for permissions when handling Subscribe messages.
		If set to 1, subscription state is considered active and the presentity
		is not queried for permissions(should be set to 1 if not using an xcap 
		server). 
		Otherwise,the xcap server is queried and the subscription states is
		according to user defined permission rules. If no rules are defined for
		a certain watcher, the subscriptions remains in pending state and the
		Notify sent will have no body.
		</para>
		<para>
		Note: When switching from one value to another, the watchers table must
		be emptied.
		</para>
		<para>
		<emphasis>Default value is <quote>0</quote>.
		</emphasis>
		</para>
		<example>
		<title>Set <varname>force_active</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("presence_xml", "force_active", 1)
...
</programlisting>
		</example>
	</section>
	<section>
		<title><varname>pidf_manipulation</varname> (int)</title>
		<para>
		Setting this parameter to 1 enables the features described in RFC 4827.
		It gives the possibility to have a permanent state notified to the users
		even in the case in which the phone is not online. The presence document
		is taken from the xcap server and aggregated together with the other
		presence information, if any exist, for each Notify that is sent to the
		watchers. It is also possible to have information notified even if not 
		issuing any Publish (useful for services such as email, SMS, MMS).
		</para>
		<para>
		<emphasis>Default value is <quote>0</quote>.
		</emphasis>
		</para>
		<example>
		<title>Set <varname>pidf_manipulation</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("presence_xml", "pidf_manipulation", 1)
...
</programlisting>
		</example>
	</section>
	<section>
		<title><varname>integrated_xcap_server</varname> (int)</title>
		<para>
		This parameter is a flag for the type of XCAP server or servers 
		used. If integrated ones, like XCAP-lite from AG Projects, 
		with direct access to database table, the parameter should be
		set to a positive value. Apart from updating in xcap table,
		the integrated server must send an MI command refershWatchers 
		[pres_uri] [event] when a user modifies a rules document. 
		</para>
		<para>
		Otherwise, it uses xcap_client module to fetch documents 
		from the XCAP servers with HTTP requests.</para>
		<para>
		<emphasis>Default value is <quote>0</quote>.
		</emphasis>
		</para>
		<example>
		<title>Set <varname>integrated_xcap_server</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("presence_xml", "integrated_xcap_server", 1)
...
</programlisting>
		</example>
	</section>
	<section>
		<title><varname>server_address</varname> (str)</title>
		<para>
		This parameter is compulsory if the integrated_xcap_server parameter
		is not set. It can be set more that once, to construct an address
		list of trusted XCAP servers.</para>
		<example>
		<title>Set <varname>xcap_server</varname> parameter</title>
		<programlisting format="linespecific">
...
modparam("presence_xml", "xcap_server", "xcap_server.example.org")
modparam("presence_xml", "xcap_server", "xcap_server.ag.org")
...
</programlisting>
		</example>
	</section>
</section>
<section>
	<title>Exported Functions</title>
	<para>
	None to be used in configuration file.
	</para>
</section>

<section>
	<title>Installation</title>
	<para>
	The module requires 1 table in OpenSER database: xcap. The SQL 
	syntax to create it can be found in presence_xml-create.sql     
	script in the database directories in the openser/scripts folder.
	You can also find the complete database documentation on the
	project webpage, &openserdbdocs;.
	</para>
</section>

</chapter>

<!-- Keep this element at the end of the file
Local Variables:
sgml-parent-document: ("presence_xml.sgml" "Book" "chapter")
End:
-->

